<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>R2 Upload</title>
<style>
body{
  background:#0b1220;
  font-family:system-ui;
  color:#fff;
  display:flex;
  justify-content:center;
  padding-top:40px;
}
.card{
  width:420px;
  background:#0f1b33;
  border-radius:12px;
  padding:25px;
  box-shadow:0 0 20px #000;
}
h2{margin-top:0;color:#4cc9f0}
input,button{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:6px;
  border:none;
}
button{
  background:#2563eb;
  color:#fff;
  cursor:pointer;
}
progress{
  width:100%;
  height:18px;
  margin-top:10px;
}
#status{margin-top:8px;font-size:14px;color:#9ca3af}
</style>
</head>
<body>

<div class="card">
  <h2>R2 Upload</h2>

  <input type="file" id="file">
  <button onclick="upload()">Upload</button>

  <progress id="progress" value="0" max="100"></progress>
  <div id="status"></div>
</div>

<script>
const WORKER_URL = "https://upfile2.trinhhoan00365.workers.dev"; // <-- đổi

async function upload(){
  const fileInput = document.getElementById("file");
  const file = fileInput.files[0];
  if(!file) return alert("Chưa chọn file");

  setStatus("Đang tạo upload URL...");

  const res = await fetch(`${WORKER_URL}/get-upload-url?name=${encodeURIComponent(file.name)}`);
  const data = await res.json();

  await uploadFile(data.uploadUrl, file);
}

function uploadFile(url, file){
  return new Promise((resolve,reject)=>{
    const xhr = new XMLHttpRequest();
    xhr.open("PUT", url, true);

    xhr.upload.onprogress = e=>{
      if(e.lengthComputable){
        const percent = Math.round(e.loaded / e.total * 100);
        document.getElementById("progress").value = percent;
        setStatus(`Đang upload: ${percent}%`);
      }
    };

    xhr.onload = ()=>{
      if(xhr.status === 200){
        setStatus("Upload thành công ✅");
        resolve();
      }else{
        setStatus("Upload lỗi ❌");
        reject();
      }
    };

    xhr.onerror = ()=>reject();

    xhr.send(file);
  });
}

function setStatus(t){
  document.getElementById("status").innerText = t;
}
</script>

</body>
</html>
